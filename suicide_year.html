<!doctype html>
<meta charset="utf-8">
<style type="text/css">
    #leftbox { 
                float:left;  
                /*background:White; */
                width:20%; 
                height:50vh; 
            } 
            #middlebox{ 
                float:left;  
                /*background:Green; */
                width:60%; 
                height:50vh; 
            } 
            #rightbox{ 
                float:left;  
                /*background:Green; */
                width:20%; 
                height:50vh; 
            } 


/* 13. Basic Styling with CSS */
.tooltip {
  position: absolute;
  text-align: left;
  width: 200px;
  height: 12px;
  padding: 8px;
  margin-top: -20px;
  font: 15px sans-serif;
  pointer-events: none;
  background: rgba(255, 255, 255, .8);
}

/* Style the lines by removing the fill and applying a stroke */
.line {
    fill: none;
    stroke: #ffab00;
    stroke-width: 3;
}
  
.overlay {
  fill: none;
  pointer-events: all;
}

/* Style the dots by assigning a fill and stroke */
.dot {
    fill: #ffab00;
    stroke: #fff;
}
  
.focus circle {
  fill: none;
  stroke: steelblue;
}

</style>
<html>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3-time.v1.min.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <head>
    <title>World Suicide Rate from 1985~2016</title>
  </head>
  <body>
    <div id = "main">
        <h1>World Suicide Rate from 1985~2016 </h1>
        <div id = "page_num">
            <button type="button" class="btn btn--light" onclick="nextPage(-1)"><</button>
            <button type="button" class="btn btn--light" onclick="gotoPage(1)">1</button>
            <button type="button" class="btn btn--light" onclick="gotoPage(2)">2</button>
            <button type="button" class="btn btn--light" onclick="gotoPage(3)">3</button>
            <button type="button" class="btn btn--light" onclick="gotoPage(4)">4</button>
            <button type="button" class="btn btn--light" onclick="nextPage(1)">></button>
        </div>
        <div id = "leftbox">
            <h2>What Year Has The Highest Suicide Rate?</h2>
            <p>Graph of Avereage Suicide Rates per year (per 100k Population)</p>
        </div>
        <div id = "middlebox">
            
        </div>
    </div>
    
    <script type="text/javascript">
		// Set the dimensions of the canvas / graph
        var margin = {top:20, right: 200, bottom: 80, left:50}
            // , width = window.innerWidth*0.7 - margin.left - margin.right
            // , height = window.innerHeight*0.6 - margin.top - margin.bottom;
            , width = document.getElementById('middlebox').clientWidth - margin.left - margin.right
            , height = document.getElementById('middlebox').clientHeight - margin.top - margin.bottom;
        
        var svg = d3.select("#middlebox").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("display", "none");
        var page_num = 1;
        var pages = 4;
        function gotoPage(num) {
            console.log("go to page:" + num);
            page_num = num;
            switch(page_num) {
                case 1:
                    break;
                case 2:
                    break;
                case 3:
                    break;
                case 4:
                    break;
            }
            load_suicides_age_year();
        }
        function nextPage(offset) {
            page_num  = page_num + offset;
            if (page_num > pages) {
                page_num = pages;
            }
            else if (page_num < 1) {
                page_num = 1;
            }
            gotoPage(page_num);
        }

        // load suicde_country dadta
        function load_suicides_country() {
            d3.csv("data/suicides_country.csv").then(function(data) {
                console.log(data);
                data = data.reverse();
                var maxdata = data[0]['Avg. Suicides_per_100K_Pop'];
                var textlen = 200;
                var margin = 50;
                console.log('max country', data[0].Country)
                var xs = d3.scaleLinear().domain([0, parseFloat(maxdata)]).range([0, width-textlen-margin]);
                var height = 20 * data.length;

                svg.attr("height", height + 30)

                svg.selectAll("rect")
                    .data(data)
                    .enter()
                    .append("rect")
                        .attr("x", textlen)
                        .attr("y", function(d, i) {return i * 20 + 20;})
                        .attr("width", function(d) {return xs(d['Avg. Suicides_per_100K_Pop']) ;})
                        .attr("height", 18)
                        .attr("fill", d3.color("steelblue"))
                        .on("mouseover", function(d) {
                            d3.select(this).attr("stroke", "black");
                            div.transition().duration(300).style("opacity", 0.9).style("display", "inline");
                            div.html(d.Country + " Suicide Rate:" + d['Avg. Suicides_per_100K_Pop'] + " pp")
                                .style("display", "inline")
                                .style("left", d3.event.pageX + 50 + "px")
                                .style("top", d3.event.pageY +20 + "px");
                        })
                        .on("mouseout", function(d) {   
                            d3.select(this).attr("stroke", "none"); 
                            div.transition()        
                                .duration(500)      
                                .style("opacity", 0)
                                .style("display", "none");  
                        });
                
                svg.selectAll("text")
                    .data(data)
                    .enter()
                    .append("text")
                        .attr("x", 10)
                        .attr("y", function(d, i) {return i * 20 + 35;})
                        .text(function(d) {return d.Country;})
                        .attr("font-size", "17px")
                        .attr("fill", "black");
            });
        }
        // load suicides_year data
        function load_suicides_year() {
            d3.csv("data/suicides_year.csv").then(function(data) {
                // template based on https://bl.ocks.org/gordlea/27370d1eea8464b04538e6d8ced39e89
                console.log(data);
                // format the data
                var parseTime = d3.timeParse("%Y");
                var formatTime = d3.timeFormat("%Y")

                data.forEach(function(d) {
                    d.Year = parseTime(d.Year);
                    d.Avg_Suicides_per_100K_Pop = +d.Avg_Suicides_per_100K_Pop;
                });
                
                var xs = d3.scaleTime()
                    .domain(d3.extent(data, function(d) {return d.Year;}))
                    .range([0, width]);

                var ys = d3.scaleLinear()
                    .domain([0, d3.max(data, function(d) {return d.Avg_Suicides_per_100K_Pop;})])
                    .range([height, 0]);


                var line = d3.line()
                    .x(function(d, i) {return xs((d.Year));})
                    .y(function(d) {return ys(d.Avg_Suicides_per_100K_Pop);})
                    .curve(d3.curveMonotoneX)
                // call the xaxis in a group tag
                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    // .call(d3.axisBottom(xs).tickFormat(d3.timeFormat("%Y"))); // Create an axis component with d3.axisBottom
                    .call(d3.axisBottom(xs)); // Create an axis component with d3.axisBottom
                // call the y axis in a group tag
                svg.append("g")
                    .attr("class", "y axis")
                    .call(d3.axisLeft(ys)); // Create an axis component with d3.axisLeft

                // append the path, bind the data
                svg.append("path")
                    .datum(data)
                    .attr("class", "line")
                    .attr("d", line)

                // 12. Appends a circle for each datapoint 
                svg.selectAll(".dot")
                    .data(data)
                  .enter().append("circle") // Uses the enter().append() method
                    .attr("class", "dot") // Assign a class for styling
                    .attr("cx", function(d, i) { return xs((d.Year)) })
                    .attr("cy", function(d) { return ys(d.Avg_Suicides_per_100K_Pop) })
                    .attr("r", 5)
                      .on("mouseout", mouseout)
                      .on("mouseout", function() {
                        d3.select(this)
                        .style("stroke", "none");
                        return mouseout();
                      })
                      .on("mouseover", function(d) {
                        d3.select(this)
                        .style("stroke", "black");
                        return mouseover(d);
                        });

                var focus = svg.append("g")
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("circle")
                  .attr("r", 4.5);

                focus.append("text")
                  .attr("x", 9)
                  .attr("dy", ".35em");

                function mouseover(d)  {
                    div.transition().duration(300).style("opacity", 0.9).style("display", "inline");
                    div.html("Year: " + formatTime(d.Year) +  "<br>Suicide Rate: " + d['Avg_Suicides_per_100K_Pop'])
                        .style("display", "inline")
                        .style("left", d3.event.pageX + 10 + "px")
                        .style("top", d3.event.pageY +20 + "px");
                }
                function mouseout() {
                    div.transition()        
                        .duration(500)      
                        .style("opacity", 0)
                        .style("display", "none");  
                }

                // text label for x axis
                // text label for the x axis
                svg.append("text")             
                  .attr("transform",
                        "translate(" + (width/2) + " ," + 
                                       (height + margin.top + 20) + ")")
                  .style("text-anchor", "middle")
                  .text("Year");

                svg.append("text")             
                  .attr("transform", "rotate(-90)")
                  .attr("y", 0 - margin.left)
                  .attr("x", 0 - (height/2))
                  .attr("dy", "1em")
                  .style("text-anchor", "middle")
                  .text("Average Suicides Every 100K Population");
            });
        }

        // load suicides_year data
        function load_suicides_age_year() {
            d3.csv("data/suicides_age_year.csv").then(function(data) {
                // template based on https://bl.ocks.org/gordlea/27370d1eea8464b04538e6d8ced39e89
                console.log("data");
                console.log(data);
                // format the data
                var parseTime = d3.timeParse("%Y");
                var formatTime = d3.timeFormat("%Y");
                var ages_groups = ["5-14 years", "15-24 years", "25-34 years", "55-74 years", "75+ years"];

                // create separate lines for each age bucket
                data.forEach(function(d) {
                    d.Year = parseTime(d.Year);
                    d.Avg_Suicides_per_100K_Pop = +d.Avg_Suicides_per_100K_Pop;
                });
                
                var dataByAge = d3.nest()
                    .key(function(d) {
                        return d.Age;
                    })
                    .entries(data);
                console.log("data by age");
                console.log(dataByAge.length);

                var xs = d3.scaleTime()
                    .domain(d3.extent(data, function(d) {return d.Year;}))
                    .range([0, width]);

                var ys = d3.scaleLinear()
                    .domain([0, d3.max(data, function(d) {return d.Avg_Suicides_per_100K_Pop;})])
                    .range([height, 0]);

                var line = d3.line()
                    .x(function(d) {
                        return xs(d.Year);
                    })
                    .y(function(d) {
                        return ys(d.Avg_Suicides_per_100K_Pop);
                    })
                    .curve(d3.curveMonotoneX);


                var colors = d3.scaleOrdinal()
                    .domain(ages_groups)
                    // .range(d3.schemeAccent);
                    .range(["#EF5285", "#88F284" , "#5965A3", "#EF5285", "#88F284" ]);
                // call the xaxis in a group tag
                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(xs)); // Create an axis component with d3.axisBottom
                // call the y axis in a group tag
                svg.append("g")
                    .attr("class", "y axis")
                    .call(d3.axisLeft(ys)); // Create an axis component with d3.axisLeft

                // append the path, bind the data
                svg.selectAll(".line")
                    .data(dataByAge)
                    .enter()
                    .append("path")
                        .attr("class", "line")
                        .attr("d", function(d) {
                            return line(d.values);
                        })
                        .attr("stroke", function(d) {
                            console.log("line");
                            console.log(d)
                            return colors(d.key)});

                // 12. Appends a circle for each datapoint 
                var ageGroups = svg.selectAll(".ageGroups")
                    .data(dataByAge)
                    .enter()
                    .append("g")
                    .attr("stroke", function(d) {
                            return colors(d.key)})
                        // .attr("stroke", function(d) {
                        //     if (d.key == "15-24 years") {
                        //         return "blue";
                        //     }
                        //     console.log("age group d");
                        //     console.log(d);
                        //     return colors(d.key)});

                var circles = ageGroups.selectAll(".circle")
                    .data(function(d) {
                        return d.values
                    })
                    .enter()
                    .append("circle")
                        .attr("class", "dot") // Assign a class for styling
                        .attr("cx", function(d) { 
                            return xs(d.Year); })
                        .attr("cy", function(d) { return ys(d.Avg_Suicides_per_100K_Pop); })
                        .attr("fill", function(d) {return colors(d.Age);})
                        .attr("r", 5)
                          .on("mouseout", mouseout)
                          .on("mouseout", function() {
                            d3.select(this)
                            .style("stroke", "none");
                            return mouseout();
                          })
                          .on("mouseover", function(d) {
                            d3.select(this)
                            .style("stroke", "black");
                            return mouseover(d);
                            });

                var focus = svg.append("g")
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("circle")
                  .attr("r", 4.5);

                focus.append("text")
                  .attr("x", 9)
                  .attr("dy", ".35em");

                function mouseover(d)  {
                    div.transition().duration(300).style("opacity", 0.9).style("display", "inline");
                    div.html("Year: " + formatTime(d.Year) + "<br>Age: " + d.Age +  "<br>Suicide Rate: " + d['Avg_Suicides_per_100K_Pop'])
                        .style("display", "inline")
                        .style("left", d3.event.pageX + 10 + "px")
                        .style("top", d3.event.pageY +20 + "px");
                }
                function mouseout() {
                    div.transition()        
                        .duration(500)      
                        .style("opacity", 0)
                        .style("display", "none");  
                }

                // text label for x axis
                // text label for the x axis
                svg.append("text")             
                  .attr("transform",
                        "translate(" + (width/2) + " ," + 
                                       (height + margin.top + 20) + ")")
                  .style("text-anchor", "middle")
                  .text("Year");

                svg.append("text")             
                  .attr("transform", "rotate(-90)")
                  .attr("y", 0 - margin.left)
                  .attr("x", 0 - (height/2))
                  .attr("dy", "1em")
                  .style("text-anchor", "middle")
                  .text("Average Suicides Every 100K Population");
            });

        }
    	
    	
    </script>
  </body>
  

</html>
