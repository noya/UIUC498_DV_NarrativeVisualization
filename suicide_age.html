<!doctype html>
<meta charset="utf-8">
<style>

.tooltip {
  position: absolute;
  text-align: center;
  width: 360px;
  height: 12px;
  padding: 8px;
  margin-top: -20px;
  font: 15px sans-serif;
  pointer-events: none;
  background: rgba(255, 255, 255, .8);
}

</style>
<html>
<script src="https://d3js.org/d3.v5.min.js"></script>
  <head>
    <title>World Suicide Rate from 1985~2016</title>
  </head>
  <body>
    <h1>World Suicide Rate from 1985~2016 </h1>
    <p>What Age Bracket Do You Think Has The Highest Suicide Rate?</p>
    <p>List of Suicide Rates per age (per 100k Population)</p>
    <script type="text/javascript">
		// Set the dimensions of the canvas / graph

        var margin = {top:20, right: 160, bottom: 50, left:30};
        var width = 960 - margin.left - margin.right;
        var height = 500 - margin.top - margin.bottom;

        var svg = d3.select("body")
                	.append("svg")
               		.attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var div = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("display", "none");

        // load data
    	d3.csv("data/suicides_age.csv").then(function(data) {
    		console.log(data);
            var maxheight = 0;
            var barwidth = 50;

            console.log(data.keys());
            var ages = new Set();
            // ages.add(data.map())
            for (var i = 0; i < data.length; i++) {
                ages.add(data[i].Age);
                maxheight = Math.max(maxheight, data[i].Avg_Suicides_per_100K_Pop);
            }
            console.log('maxheight' + maxheight);
            console.log('ages' + Array.from(ages));

    		var ys = d3.scaleLinear().domain([0, maxheight]).range([height, 0]);
            var xs = d3.scaleLinear().domain([0, data.length]).range([0, width]);
            var x = d3.scalePoint().domain(["5-14", "15-24", "25-34", "35-54", "55-74", "75+", ""]).range([0, width]);

            var cs = d3.scaleLinear().domain([0, 1]).range(['steelblue', 'orange']);
            var sexmap = new Map([['male', 0], ['female', 1]]);
            console.log('male' + sexmap.get('male'));
            // console.log('x' + xs('25-34 years'))
            svg.attr("height", height);
            svg.append("g")
                    .attr("transform", "translate("+margin.left+","+margin.top+")")
                .selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                    .attr("x", function(d, i) {return xs(i);})
                    .attr("y", function(d, i) {return ys(d.Avg_Suicides_per_100K_Pop);})
                    .attr("width", function(d, i) {return barwidth;})
                    .attr("height", function(d) {return height-ys(d.Avg_Suicides_per_100K_Pop);})
                    .attr("fill", function(d) {return cs(sexmap.get(d.Sex));})
                    .on("mouseover", function(d) {
                        d3.select(this).attr("stroke", "black");
                        div.transition().duration(300).style("opacity", 0.9).style("display", "inline");
                        div.html("Age: " + d.Age + " <br>Sex: " + d.Sex + "<br>Suicide Rate: " + d['Avg_Suicides_per_100K_Pop'])
                            .style("display", "inline")
                            .style("left", d3.event.pageX + 50 + "px")
                            .style("top", d3.event.pageY +20 + "px");
                    })
                    .on("mouseout", function(d) {   
                        d3.select(this).attr("stroke", "none"); 
                        div.transition()        
                            .duration(500)      
                            .style("opacity", 0)
                            .style("display", "none");  
                    });
            
            svg.append("g")
                .attr("transform", "translate("+margin.left+","+margin.top+")")
                .call(d3.axisLeft(ys));
            svg.append("g")
                .attr("transform", "translate("+margin.left+", "+(height+margin.top)+")")
                .call(d3.axisBottom().scale(x).ticks(6));

    	});

    	
    </script>
  </body>
  

</html>
